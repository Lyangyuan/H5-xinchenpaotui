<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.min.css" rel="stylesheet" />
		<script src="../js/mui.min.js"></script>
		<script src="js/app.js"></script>
		<script type="text/javascript" src="../js/jquery.js"></script>
		<script type="text/javascript">
			mui.init()
		</script>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">用户注册</h1>
		</header>
		<div class="mui-content">
			<form id="regForm" class="mui-input-group" style="width: 95%;margin: auto;margin-top: 5px;">
				<div class="mui-input-row">
					<label>账号</label>
					<input value="111" name="user_id" id="user_id" type="text" class="mui-input-clear mui-input" placeholder="请输入账号">
				</div>
				<div class="mui-input-row">
					<label>密码</label>
					<input value="1111111" name="password" id='password' type="password" class="mui-input-clear mui-input" placeholder="请输入密码">
				</div>
				<div class="mui-input-row">
					<label>确认</label>
					<input value="1111111" name="password_confirm" id='password_confirm' type="password" class="mui-input-clear mui-input" placeholder="请确认密码">
				</div>
				<div class="mui-input-row">
					<label>邮箱</label>
					<input value="111@126.com" name="email" id='email' type="email" class="mui-input-clear mui-input" placeholder="请输入邮箱">
				</div>
				<div class="mui-input-row">
					<label>电话+86</label>
					<input value="15709782993" name="phone" id='phone' type="email" class="mui-input-clear mui-input" placeholder="请输入电话">
				</div>
				<div class="mui-input-row">
					<label>地址</label>
					<input value="青海西宁" id='address' name="address" type="email" class="mui-input-clear mui-input" placeholder="请选择地址">
				</div>
			</form>
			<div class="mui-content-padded">
				<button id='reg' class="mui-btn mui-btn-block mui-btn-primary">注册</button>
			</div>
		</div>
		<script>
			mui.plusReady();
			jQuery.noConflict();

			/**************************************************************************/
			//判断邮箱
			function chargeEmail(email){
				if(email.indexOf("@") <= 0 || email.indexOf(".com") <= 0||email.split("@")[0].length<=0){
					return "请输入正确的邮箱格式：xxxxxxx@xxx.com";
				}else{
					return null;
				}
			}

			/**************************************************************************/
			//用户注册
			jQuery("#reg").on("tap", function() {
				var user_id = jQuery("#user_id").val();
				var pass = jQuery("#password").val();
				var pass_confirm = jQuery("#password_confirm").val();
				var email = jQuery("#email").val();
				var phone = jQuery("#phone").val();
				var address = jQuery("#address").val();
				if(user_id == "" || user_id == null) {
					mui.toast("账号不能为空");
				} else if(pass == "" || pass == null) {
					mui.toast("密码不能为空");
				} else if(pass.length <= 6) {
					mui.toast("密码长度不能小于6位");
				} else if(pass_confirm == "" || pass_confirm == null) {
					mui.toast("请再次输入密码");
				} else if(pass != pass_confirm) {
					mui.toast("两次输入密码不一致，请重新输入");
					pass_confirm.value = "";
				} else if(email == "" || email == null) {
					mui.toast("请输入邮箱");
				} else if(chargeEmail(email)!=null) {
					mui.toast("请输入正确的邮箱格式：xxxxxxx@xxx.com");
					email.value = "";
				} else if(phone == "" || phone == null) {
					mui.toast("请输入电话号码");
				} else if(address == "" || address == null) {
					mui.toast("地址不能为空");
				} else {
					/*mui.toast(jQuery("#regForm").serialize());*/
					jQuery.post(
						"http://localhost:8080/paotui/RegistServlet",
						jQuery("#regForm").serialize(),
						function(data, statusText, xhr) {
							jQuery.each(data, function(i, n) {
								if(n.result == "200") {
									mui.toast("注册成功,返回登陆页面进行登陆");
									setTimeout(function() {
										mui.openWindow({
											url: "../index.html",
											id: "index",
											show: {
												aniShow: 'pop-in'
											},
											waiting: {
												autoShow: false
											}
										});
									}, 3000);
								} else {
									mui.toast(n.result);
								}
							});
						},
						"json"
					);
				}
			});
		</script>
	</body>

</html>